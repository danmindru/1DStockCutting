function next_fit(a,b,c){for(var d=0,e=a,f=0;f<b.length;f++)b[f]>e&&(d++,e=a),e-=b[f],c[f]=d;return d+1}function first_fit(a,b,c){var d=1,e=new Array(b.length);if(void 0===e)return 0;e[0]=a;for(var f=0;f<b.length;f++){for(var g=0,h=0;h<d&&!g;h++)e[h]>=b[f]&&(e[h]-=b[f],c[f]=h,g=1);g||(e[d]=a-b[f],c[f]=d,d++)}return d}function superlative_fit(a,b,c,d){var e=1,f=new Array(b.length);if(void 0===f)return 0;f[0]=a;for(var g=0;g<b.length;g++){for(var h=-1,i=0,j=0;j<e;j++)f[j]>=b[g]&&(h==-1||"BEST"==d&&f[j]<i||"WORST"==d&&f[j]>i)&&(h=j,i=f[j]);h!=-1?(f[h]-=b[g],c[g]=h):(f[e]=a-b[g],c[g]=e,e++)}return e}function best_fit(a,b,c){return superlative_fit(a,b,c,"BEST")}function worst_fit(a,b,c){return superlative_fit(a,b,c,"WORST")}function first_fit_decreasing(a,b,c){return b.sort(function(a,b){return b-a}),first_fit(a,b,c)}function best_fit_decreasing(a,b,c){return b.sort(function(a,b){return b-a}),best_fit(a,b,c)}function worst_fit_decreasing(a,b,c){return b.sort(function(a,b){return b-a}),worst_fit(a,b,c)}var stockCutting=angular.module("stockCutting",["ngMaterial","ngStorage","ngFileUpload","pascalprecht.translate"]);stockCutting.config(["$mdThemingProvider","$translateProvider",function(a,b){a.definePalette("customPalette",{50:"#858585",100:"#5e5e5e",200:"#424242",300:"#1f1f1f",400:"#0f0f0f",500:"#000000",600:"#000000",700:"#000000",800:"#000000",900:"#000000",A100:"#858585",A200:"#5e5e5e",A400:"#0f0f0f",A700:"#000000",contrastDefaultColor:"light",contrastDarkColors:"50 A100"}),a.theme("default").primaryPalette("customPalette").accentPalette("green"),b.translations("en",{TITLE:"1D Stock Cutting",TITLE_UPLOAD_ARIA:"Load saved project from disk",TITLE_DOWNLOAD_ARIA:"Save project to disk",FORM_NAME:"Project Name",FORM_UNITS:"Units",FORM_STOCK:"Stock Length",FORM_CUT:"Cut Width",FORM_ALGORITHM:"Algorithm",FORM_BUTTON_ADD:"ADD PART",FORM_ADD_ARIA:"Add Part",FORM_PART_LENGTH:"Length",FORM_PART_QTT:"Quantity",FORM_PART_REMOVE_ARIA:"Remove part",RESULT_TITLE:"Cut List",RESULT_PRINT_ARIA:"Print Cut List",RESULT_INVENTORY:"Inventory",RESULT_STOCK_NEEDED:"Stock Needed",RESULT_TOTAL_LENGTH:"Total Length",RESULT_WASTE:"Waste",RESULT_CUT_LIST:"Cut List",RESULT_STOCK_PREFIX:"Stock "}),b.translations("ro",{TITLE:"Taiere optimizata 1D",TITLE_UPLOAD_ARIA:"Incarca proiect salvat pe hard-disk",TITLE_DOWNLOAD_ARIA:"Salvare proiect pe hard-disk",FORM_NAME:"Nume proiect",FORM_UNITS:"Unitate de masura (i.e. m)",FORM_STOCK:"Lungime stoc (i.e. 12)",FORM_CUT:"Marime taietura (i.e. 0.1)",FORM_ALGORITHM:"Algoritm",FORM_BUTTON_ADD:"Adauga parte de taiat",FORM_ADD_ARIA:"Adauga parte de taiat",FORM_PART_LENGTH:"Lungime",FORM_PART_QTT:"Cantitate",FORM_PART_REMOVE_ARIA:"Sterge",RESULT_TITLE:"Lista taieturi",RESULT_PRINT_ARIA:"Printeaza lista taieturi",RESULT_INVENTORY:"Inventar",RESULT_STOCK_NEEDED:"Stoc necesar",RESULT_TOTAL_LENGTH:"Marime totala",RESULT_WASTE:"Pierderi",RESULT_CUT_LIST:"Lista taieturi",RESULT_STOCK_PREFIX:"Stoc "}),b.registerAvailableLanguageKeys(["ro","en"],{"ro*":"ro","en*":"en"}).fallbackLanguage("en").useSanitizeValueStrategy("escape"),b.preferredLanguage("ro")}]),stockCutting.directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){b.$emit(d.onFinishRender)})}}}]),stockCutting.controller("1DCtrl",["$scope","$localStorage","$window","$timeout","Upload",function(a,b,c,d,e){a.algorithms=[{method:"next_fit",name:"Next Fit"},{method:"first_fit",name:"First Fit"},{method:"best_fit",name:"Best Fit"},{method:"worst_fit",name:"Worst Fit"},{method:"best_fit_decreasing",name:"Best Fit Decreasing"},{method:"worst_fit_decreasing",name:"Worst Fit Decreasing"}],a.units=["mm","cm","m","in","ft"],a.project=b.$default({name:"Proiect #1",alg:4,cutSize:0,parts:[],stockLength:12,units:"m"}),a.cutList={},a.changeLanguage=function(a){$translate.use(a)},a.pack1D=function(b,c,d,e){for(var f=[],g=0;g<d.length;g++)if(void 0!==d[g].size)for(var h=0;h<d[g].quantity;h++)f.push(d[g].size+c);var i,j=new Array(f.length),k=window[b];"function"==typeof k&&(i=k.apply(null,[e,f,j]));var l={};for(l.binsUsed=i,l.items=[],l.cutSize=c,l.stockLength=e,g=0;g<f.length;g++)l.items.push({length:f[g],bin:j[g]});for(l.items.sort(function(a,b){return a.bin>b.bin?1:a.bin<b.bin?-1:0}),g=0;g<f.length;g++)f[g]=f[g]-c;a.createCutList(l)},a.createCutList=function(b){var c=["rgba(54, 162, 235, 0.4)","rgba(255, 206, 86, 0.4)","rgba(75, 192, 192, 0.4)","rgba(153, 102, 255, 0.4)","rgba(255, 159, 64, 0.4)"],d=["rgb(54, 162, 235)","rgb(255, 206, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(255, 159, 64)"],e="rgba(80,80,80,0.1)",f="rgba(50,50,50)",g=0;a.cutList={nbStock:b.binsUsed,cutSize:b.cutSize,stockLength:b.stockLength,totalStockLength:b.binsUsed*b.stockLength,fillColor:e,strokeColor:f,bins:new Array(b.binsUsed)};var h=[];for(var i in b.items){var k=b.items[i];h.indexOf(k.length-b.cutSize)==-1&&h.push(k.length-b.cutSize)}for(i in b.items){g+=b.items[i].length-b.cutSize,void 0===a.cutList.bins[b.items[i].bin]&&(a.cutList.bins[b.items[i].bin]=[]);var l={length:b.items[i].length-b.cutSize,label:b.items[i].bin+1+"."+(a.cutList.bins[b.items[i].bin].length+1),fillColor:c[h.indexOf(b.items[i].length-b.cutSize)%c.length],strokeColor:d[h.indexOf(b.items[i].length-b.cutSize)%d.length]};a.cutList.bins[b.items[i].bin].push(l)}for(i in a.cutList.bins)a.cutList.bins[i].sort(function(a,b){return a.length<b.length?1:a.length>b.length?-1:0});for(var m in a.cutList.bins){var n={},o=a.cutList.bins[m];for(i=0,j=o.length;i<j;i++)n[o[i].length]=(n[o[i].length]||0)+1;a.cutList.bins[m].parts=n;for(var p="",q=Object.keys(n).length-1;q>=0;q--)p+=n[Object.keys(n)[q]]+" x "+Object.keys(n)[q]+a.project.units,0!==q&&(p+=" + ");a.cutList.bins[m].description=p}a.cutList.totalLength=g,a.cutList.waste=b.binsUsed*b.stockLength-g},a.removePart=function(b){a.project.parts.splice(b,1),a.submit()},a.addPart=function(){a.project.parts.push({size:a.project.stockLength,quantity:1}),a.submit()},a.submit=function(){a.pack1D(a.algorithms[a.project.alg].method,a.project.cutSize,a.project.parts,a.project.stockLength)},a.downloadProject=function(){var b="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a.project)),c=document.getElementById("downloadAnchorElem");c.setAttribute("href",b),c.setAttribute("download",a.project.name+".json"),c.click()},a.uploadProject=function(b,c){a.f=b,a.errFile=c&&c[0],b&&(b.upload=e.upload({url:"https://angular-file-upload-cors-srv.appspot.com/upload",data:{file:b}}),b.upload.then(function(c){d(function(){b.result=c.data;var d=new FileReader;d.addEventListener("load",function(){a.$apply(function(){var b=JSON.parse(d.result);for(var c in Object.keys(b))a.project[Object.keys(b)[c]]=b[Object.keys(b)[c]];a.submit()})}),d.readAsText(b,"UTF-8")})},function(b){b.status>0&&(a.errorMsg=b.status+": "+b.data)},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total))}))},a.save=function(){b.message=a.project},a.drawBars=function(b){for(var c in a.cutList.bins){var d=a.cutList.bins[c],e=SVG("drawing-"+c).size(b,35);e.rect("100%",35).fill({color:"#FFF"});var f=document.getElementById("drawing-"+c),g=f.getBoundingClientRect();e.rect("100%",35).fill({color:a.cutList.fillColor}).stroke({color:a.cutList.strokeColor});for(var h=0,i=g.width/a.cutList.stockLength,j=0;j<d.length;j++)e.rect(d[j].length*i,35).fill({color:d[j].fillColor}).stroke({color:d[j].strokeColor}).translate(h*i,0),e.text(d[j].length+"").font({family:"Helvetica",size:12,anchor:"middle",leading:"1.8em"}).fill({color:"rgba(0,0,0,0.5)"}).translate((h+d[j].length/2)*i,0),h+=d[j].length+a.cutList.cutSize}},a.print=function(){a.drawBars("180mm"),window.print()};var f=angular.element(c);f.onbeforprint=function(){console.log("GOING TO PRINT")},f.bind("resize",function(){a.$emit("ngRepeatFinished")}),a.$on("ngRepeatFinished",function(b){a.drawBars("100%")}),a.submit()}]),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();
//# sourceMappingURL=app.min.js.map